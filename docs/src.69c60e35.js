parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"FheM":[function(require,module,exports) {
var t=null;function e(){return t||(t=n()),t}function n(){try{throw new Error}catch(e){var t=(""+e.stack).match(/(https?|file|ftp|chrome-extension|moz-extension):\/\/[^)\n]+/g);if(t)return r(t[0])}return"/"}function r(t){return(""+t).replace(/^((?:https?|file|ftp|chrome-extension|moz-extension):\/\/.+)\/[^/]+$/,"$1")+"/"}exports.getBundleURL=e,exports.getBaseURL=r;
},{}],"TUK3":[function(require,module,exports) {
var r=require("./bundle-url").getBundleURL;function e(r){Array.isArray(r)||(r=[r]);var e=r[r.length-1];try{return Promise.resolve(require(e))}catch(n){if("MODULE_NOT_FOUND"===n.code)return new s(function(n,i){t(r.slice(0,-1)).then(function(){return require(e)}).then(n,i)});throw n}}function t(r){return Promise.all(r.map(u))}var n={};function i(r,e){n[r]=e}module.exports=exports=e,exports.load=t,exports.register=i;var o={};function u(e){var t;if(Array.isArray(e)&&(t=e[1],e=e[0]),o[e])return o[e];var i=(e.substring(e.lastIndexOf(".")+1,e.length)||e).toLowerCase(),u=n[i];return u?o[e]=u(r()+e).then(function(r){return r&&module.bundle.register(t,r),r}).catch(function(r){throw delete o[e],r}):void 0}function s(r){this.executor=r,this.promise=null}s.prototype.then=function(r,e){return null===this.promise&&(this.promise=new Promise(this.executor)),this.promise.then(r,e)},s.prototype.catch=function(r){return null===this.promise&&(this.promise=new Promise(this.executor)),this.promise.catch(r)};
},{"./bundle-url":"FheM"}],"QCba":[function(require,module,exports) {
function e(){const e=[];for(let o=0;o<40;o++)e.push("0123456789abcdef"[Math.floor(Math.random()*"0123456789abcdef".length)]);return e.join("")}const o=e();let n=null;const t=new Map;let i=null,r=null,s=null;const a=document.querySelector("select#languages");let l=!0;function c(){const e=[`<li>${i}</li>`];for(const o of t.values())e.push(`<li>${o.displayName}</li>`);document.querySelector("#peers").innerHTML=e.join("")}function u(){window.location.href=window.location.pathname+"?room="+e()}async function d(e){const r=localStorage.getItem("editor-name");null!=(i=null==r?prompt("Your name is..."):prompt("Your name is...",r))&&""!==i||(i=`Peer ${o.slice(0,8)}`),localStorage.setItem("editor-name",i),c();const s=await require("_bundle_loader")(require.resolve("bittorrent-tracker"));n=new s({infoHash:e,peerId:o,announce:["wss://tracker.openwebtorrent.com","wss://tracker.btorrent.xyz"]}),console.debug("tracker:",n),n.setInterval(9e5),n.on("warning",console.warn),n.on("error",console.error),n.on("peer",e=>{console.debug("peer:",e);const o=e.id;40!==o.length||t.has(o)||e.on("connect",()=>{g(e),c()})}),n.start()}function g(e){const o=e.id;t.set(o,{displayName:"",conn:e,position:{lineNumber:1,column:1},positionDecorations:[],selection:{selectionStartLineNumber:0,selectionStartColumn:0,positionLineNumber:0,positionColumn:0},selectionDecorations:[]}),e.on("data",e=>v(o,e)),e.on("close",()=>{console.debug("peer closed:",e.id);const o=t.get(e.id);o&&(null==r||r.deltaDecorations(o.positionDecorations,[]),t.delete(e.id)),c()}),e.on("error",o=>{t.has(e.id)&&console.error("peer error:",o)}),e.send(JSON.stringify({type:"greet",value:i}));const n=s.getValue();n.length>0&&e.send(JSON.stringify({type:"state",value:n,language:a.value}));const l=null==r?void 0:r.getPosition();null!=l&&e.send(JSON.stringify({type:"cursor",value:l}))}function p(e){console.debug("broadcasting to:",t);const o=JSON.stringify(e);for(const n of t.values())try{n.conn.send(o)}catch{}}async function m(e){const o=await require("_bundle_loader")(require.resolve("monaco-editor"));console.debug("new peer position:",e.position),e.positionDecorations=r.deltaDecorations(e.positionDecorations,[{range:new o.Range(e.position.lineNumber,e.position.column,e.position.lineNumber,e.position.column),options:{className:"peer-cursor"}}])}async function y(e){const o=await require("_bundle_loader")(require.resolve("monaco-editor"));console.debug("new peer selection:",e.selection),e.selectionDecorations=r.deltaDecorations(e.selectionDecorations,[{range:new o.Range(e.selection.selectionStartLineNumber,e.selection.selectionStartColumn,e.selection.positionLineNumber,e.selection.positionColumn),options:{className:"peer-selection"}}])}async function v(e,o){const n=JSON.parse(new TextDecoder("utf-8").decode(o));console.debug("incoming:",n);const i=t.get(e);if(null==i)return;if(null==s)return;const r=await require("_bundle_loader")(require.resolve("monaco-editor"));if(l=!1,"edits"===n.type){const e=n.value.map(e=>{const o=e.range;return{range:new r.Range(o.startLineNumber,o.startColumn,o.endLineNumber,o.endColumn),text:e.text,forceMoveMarkers:!0}});s.pushEditOperations([],e,()=>null),console.debug("incoming done")}else"greet"===n.type?(i.displayName=n.value,c()):"state"===n.type?(s.setValue(n.value),a.value=n.language,r.editor.setModelLanguage(s,n.language)):"cursor"===n.type?(i.position=n.value,m(i)):"changeLanguage"===n.type?(a.value=n.value,r.editor.setModelLanguage(s,n.value)):"selection"===n.type&&(i.selection=n.value,y(i));l=!0}async function f(){const e=new URLSearchParams(window.location.search).get("room");if(!e){const e=document.querySelector("#new-room");return e.addEventListener("click",u,!1),void(e.style.display="block")}document.querySelector("#container").style.display="grid";d(e);const o=await require("_bundle_loader")(require.resolve("monaco-editor"));r=o.editor.create(document.getElementById("editor"),{value:"",language:"plaintext",scrollBeyondLastLine:!1}),console.debug("editor:",r),s=r.getModel(),console.debug("model:",s),s.onDidChangeContent(e=>{console.debug("changeContent:",e),l&&p({type:"edits",value:e.changes})}),r.onDidChangeCursorPosition(e=>{console.debug("changeCursor:",e),p({type:"cursor",value:e.position})}),r.onDidChangeCursorSelection(e=>{console.debug("selection:",e.selection),p({type:"selection",value:e.selection})}),a.innerHTML=o.languages.getLanguages().filter(e=>void 0!==e.aliases).map(e=>`<option value="${e.id}">${e.aliases[0]}</option>`).join(""),a.addEventListener("change",e=>{o.editor.setModelLanguage(s,a.value),p({type:"changeLanguage",value:a.value})}),window.addEventListener("beforeunload",function(){for(const e of t.values())e.conn.destroy();n.stop()})}console.info("peerId:",o),f();
},{"_bundle_loader":"TUK3","bittorrent-tracker":[["bittorrent-tracker.52b0f8c3.js","y1cx"],"y1cx"],"monaco-editor":[["editor.main.e34e9166.js","fEHy"],"editor.main.9c564fdb.css","fEHy"]}],"pBGv":[function(require,module,exports) {

var t,e,n=module.exports={};function r(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function i(e){if(t===setTimeout)return setTimeout(e,0);if((t===r||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}function u(t){if(e===clearTimeout)return clearTimeout(t);if((e===o||!e)&&clearTimeout)return e=clearTimeout,clearTimeout(t);try{return e(t)}catch(n){try{return e.call(null,t)}catch(n){return e.call(this,t)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:r}catch(n){t=r}try{e="function"==typeof clearTimeout?clearTimeout:o}catch(n){e=o}}();var c,s=[],l=!1,a=-1;function f(){l&&c&&(l=!1,c.length?s=c.concat(s):a=-1,s.length&&h())}function h(){if(!l){var t=i(f);l=!0;for(var e=s.length;e;){for(c=s,s=[];++a<e;)c&&c[a].run();a=-1,e=s.length}c=null,l=!1,u(t)}}function m(t,e){this.fun=t,this.array=e}function p(){}n.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];s.push(new m(t,e)),1!==s.length||l||i(h)},m.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.env={},n.argv=[],n.version="",n.versions={},n.on=p,n.addListener=p,n.once=p,n.off=p,n.removeListener=p,n.removeAllListeners=p,n.emit=p,n.prependListener=p,n.prependOnceListener=p,n.listeners=function(t){return[]},n.binding=function(t){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(t){throw new Error("process.chdir is not supported")},n.umask=function(){return 0};
},{}],"Yi9z":[function(require,module,exports) {
module.exports=function(n){return new Promise(function(e,o){var r=document.createElement("script");r.async=!0,r.type="text/javascript",r.charset="utf-8",r.src=n,r.onerror=function(n){r.onerror=r.onload=null,o(n)},r.onload=function(){r.onerror=r.onload=null,e()},document.getElementsByTagName("head")[0].appendChild(r)})};
},{}],"dZuk":[function(require,module,exports) {
module.exports=function(e){return new Promise(function(n,o){var r=document.createElement("link");r.rel="stylesheet",r.href=e,r.onerror=function(e){r.onerror=r.onload=null,o(e)},r.onload=function(){r.onerror=r.onload=null,n()},document.getElementsByTagName("head")[0].appendChild(r)})};
},{}],0:[function(require,module,exports) {
var b=require("TUK3");b.register("js",require("Yi9z"));b.register("css",require("dZuk"));
},{}]},{},[0,"QCba"], null)